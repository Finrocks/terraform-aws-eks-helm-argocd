---
#
# This is the canonical configuration for the `README.md`
# Run `make readme` to rebuild the `README.md`
#

# Name of this project
name: terraform-aws-eks-helm-argocd

# Tags of this project
tags:
  - github-action

# Logo for this project
#logo: docs/logo.png

# License of this project
license: "APACHE2"

# Canonical GitHub repo
github_repo: Finrocks/terraform-aws-eks-helm-argocd

# Badges to display
badges:
  - name: "Latest Release"
    image: "https://img.shields.io/github/release/cloudposse/github-action-deploy-helmfile.svg"
    url: "https://github.com/cloudposse/github-action-deploy-helmfile/releases/latest"
  - name: "Slack Community"
    image: "https://slack.cloudposse.com/badge.svg"
    url: "https://slack.cloudposse.com"

related: []

# Short description of this project
description: Deploy on Kubernetes with HelmFile

introduction: |-
  Deploy on Kubernetes with HelmFile. 
references:
  - name: "github-actions-workflows"
    description: "Reusable workflows for different types of projects"
    url: "https://github.com/cloudposse/github-actions-workflows"
  - name: "example-github-action-release-workflow"
    description: "Example application with complicated release workflow"
    url: "https://github.com/cloudposse/example-github-action-release-workflow"

# How to use this project
usage: |-
  Deploy environment
  ```hcl
    locals {
  argocd_values = templatefile("./helm-values/argocd.yaml",
    {
      argocd_url                      = "${var.argocd_url}"
      admin_password                  = data.aws_ssm_parameter.encrypted_password.value
      github_token                    = var.argocd_github_access_token
    }
  )
}
              
    module "argocd" {
      enabled = true
      source  = "git::git@github.com:Finrocks/terraform-aws-eks-helm-argocd.git"
      #version = "0.2.0"
      eks_cluster_id = module.eks.eks_cluster_id
      config = {
        create_default_iam_policy = true
        create_default_iam_role = true
        #iam_policy_document = data.aws_iam_policy_document.this.json
        use_sts_regional_endpoints = true
      }
      helm_config = {
        name                                     = "argocd"
        namespace                                = local.argocd_namespace
        repository                               = "https://argoproj.github.io/argo-helm"
        chart                                    = "argo-cd"
        version                                  = "5.13.8"
        max_history                              = 10
        create_namespace                         = true
        dependency_update                        = true
        wait                                     = true
        wait_for_jobs                            = true
        timeout                                  = 300
        recreate_pods                            = true
        override_values                          = local.argocd_values
      }
      argocd_config = {
      }
      context = module.argocd_label.context
      # Uncomment on first apply
      depends_on = [
        time_sleep.eks_node_groups_wait
      ]
    }
    ```

#include:
#  - "docs/github-action.md"

# Contributors to this project
contributors:
  - name: "Oleksandr Bortnik"
    github: "Finrocks"
